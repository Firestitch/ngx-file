@if (label || labels.length) {
  <fs-label-field>
    @if (label) {
      <fs-label class="fs-form-label">
        {{ label }}
      </fs-label>
    } @else {
      @if (labels.length) {
        <fs-label
          class="fs-form-label">
          <ng-content select="[fsFileLabel]"></ng-content>
        </fs-label>
      }
    }
    <ng-container [ngTemplateOutlet]="fileTemplate"></ng-container>
    <fs-label-message class="fs-form-message">
      <span class="fs-form-hint">
        <ng-content select="[fsFileHint]"></ng-content>
      </span>
      <ng-content select="[fsFileMessageLabel]"></ng-content>
    </fs-label-message>
  </fs-label-field>
} @else {
  <ng-container [ngTemplateOutlet]="fileTemplate"></ng-container>
}
<ng-template #fileTemplate>
  <fs-file
    [accept]="accept"
    (select)="selectFile($event)"
    (declined)="declined()"
    (beforeProcessing)="beforeProcessing($event)"
    [imageWidth]="imageWidth"
    [imageHeight]="imageHeight"
    [imageQuality]="imageQuality"
    [disabled]="disabled"
    [multiple]="multiple">
    <div
      class="wrap"
      [style.width]="previewWidth ? previewWidth + 'px' : '100%'"
      [style.height]="previewHeight + 'px'"
      [ngClass]="{ processing: processing, 'has-file': !!file }">
      @if (processing) {
        <mat-spinner [diameter]="50"></mat-spinner>
      }
      @if (file) {
        <fs-file-preview
          class="preview"
          [file]="file"
          [actions]="actions"
          [showActionOn]="showActionOn"
          [showFilename]="showFilename"
          [previewHeight]="previewHeight"
          [previewWidth]="previewWidth">
          @if (allowRemove && !disabled) {
            <ng-template
              fs-file-preview-action
              placement="bottom-left"
              action="remove"
              [icon]="'close'"
              (click)="removeFile($event)">
            </ng-template>
          }
          @if (showReuploadAction && allowReupload && !disabled) {
            <ng-template
              fs-file-preview-action
              placement="bottom-right"
              tooltip="Reupload"
              [icon]="uploadIcon">
            </ng-template>
          }
          <ng-template
            fs-file-preview-action
            placement="top-right"
            action="download"
            [icon]="'download'"
            [show]="allowDownload && ((this.download.observers.length && !!file) || !!file?.url)"
            (click)="downloadClicked($event)">
          </ng-template>
        </fs-file-preview>
      } @else {
        @if (filePickerSelectTemplate) {
          <ng-container [ngTemplateOutlet]="filePickerSelectTemplate"></ng-container>
        }
        @if (!filePickerSelectTemplate) {
          <div class="select">
            <mat-icon>
              upload
            </mat-icon>
            <div class="instruction">
              {{ instruction }}
            </div>
            <button
              [disabled]="disabled"
              type="button"
              mat-stroked-button>
              Upload
            </button>
          </div>
        }
      }
    </div>
  </fs-file>
</ng-template>